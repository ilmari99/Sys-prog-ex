# T 1.1

# PS C:\Users\ivaht\Desktop\PYTHON\Python_scripts\systeemiohjelmointi> ./W4/lottery.py -s 1 -j 3 -c
# -----
# ** Solutions **
# Random 651593 -> Winning ticket 119 (of 153) -> Run 2
# Jobs:
# (  job:0 timeleft:1 tix:84 )  (  job:1 timeleft:7 tix:25 )  (* job:2 timeleft:4 tix:44 )
# Random 788724 -> Winning ticket 9 (of 153) -> Run 0
# Jobs:
# (* job:0 timeleft:1 tix:84 )  (  job:1 timeleft:7 tix:25 )  (  job:2 timeleft:3 tix:44 )
# --> JOB 0 DONE at time 2
# Random 93859 -> Winning ticket 19 (of 69) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:7 tix:25 )  (  job:2 timeleft:3 tix:44 )
# Random 28347 -> Winning ticket 57 (of 69) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:6 tix:25 )  (* job:2 timeleft:3 tix:44 )
# Random 835765 -> Winning ticket 37 (of 69) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:6 tix:25 )  (* job:2 timeleft:2 tix:44 )
# Random 432767 -> Winning ticket 68 (of 69) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:6 tix:25 )  (* job:2 timeleft:1 tix:44 )
# --> JOB 2 DONE at time 6
# Random 762280 -> Winning ticket 5 (of 25) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:6 tix:25 )  (  job:2 timeleft:0 tix:--- )
# Random 2106 -> Winning ticket 6 (of 25) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:5 tix:25 )  (  job:2 timeleft:0 tix:--- )
# Random 445387 -> Winning ticket 12 (of 25) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:4 tix:25 )  (  job:2 timeleft:0 tix:--- )
# Random 721540 -> Winning ticket 15 (of 25) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:3 tix:25 )  (  job:2 timeleft:0 tix:--- )
# Random 228762 -> Winning ticket 12 (of 25) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:2 tix:25 )  (  job:2 timeleft:0 tix:--- )
# Random 945271 -> Winning ticket 21 (of 25) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:1 tix:25 )  (  job:2 timeleft:0 tix:--- )
# --> JOB 1 DONE at time 12



# ./W4/lottery.py -s 2 -j 3 -c

# ** Solutions **

# Random 605944 -> Winning ticket 169 (of 197) -> Run 2
# Jobs:
# (  job:0 timeleft:9 tix:94 )  (  job:1 timeleft:8 tix:73 )  (* job:2 timeleft:6 tix:30 )
# Random 606802 -> Winning ticket 42 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:9 tix:94 )  (  job:1 timeleft:8 tix:73 )  (  job:2 timeleft:5 tix:30 )
# Random 581204 -> Winning ticket 54 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:8 tix:94 )  (  job:1 timeleft:8 tix:73 )  (  job:2 timeleft:5 tix:30 )
# Random 158383 -> Winning ticket 192 (of 197) -> Run 2
# Jobs:
# (  job:0 timeleft:7 tix:94 )  (  job:1 timeleft:8 tix:73 )  (* job:2 timeleft:5 tix:30 )
# Random 430670 -> Winning ticket 28 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:7 tix:94 )  (  job:1 timeleft:8 tix:73 )  (  job:2 timeleft:4 tix:30 )
# Random 393532 -> Winning ticket 123 (of 197) -> Run 1
# Jobs:
# (  job:0 timeleft:6 tix:94 )  (* job:1 timeleft:8 tix:73 )  (  job:2 timeleft:4 tix:30 )
# Random 723012 -> Winning ticket 22 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:6 tix:94 )  (  job:1 timeleft:7 tix:73 )  (  job:2 timeleft:4 tix:30 )
# Random 994820 -> Winning ticket 167 (of 197) -> Run 2
# Jobs:
# (  job:0 timeleft:5 tix:94 )  (  job:1 timeleft:7 tix:73 )  (* job:2 timeleft:4 tix:30 )
# Random 949396 -> Winning ticket 53 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:5 tix:94 )  (  job:1 timeleft:7 tix:73 )  (  job:2 timeleft:3 tix:30 )
# Random 544177 -> Winning ticket 63 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:4 tix:94 )  (  job:1 timeleft:7 tix:73 )  (  job:2 timeleft:3 tix:30 )
# Random 444854 -> Winning ticket 28 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:3 tix:94 )  (  job:1 timeleft:7 tix:73 )  (  job:2 timeleft:3 tix:30 )
# Random 268241 -> Winning ticket 124 (of 197) -> Run 1
# Jobs:
# (  job:0 timeleft:2 tix:94 )  (* job:1 timeleft:7 tix:73 )  (  job:2 timeleft:3 tix:30 )
# Random 35924 -> Winning ticket 70 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:2 tix:94 )  (  job:1 timeleft:6 tix:73 )  (  job:2 timeleft:3 tix:30 )
# Random 27444 -> Winning ticket 61 (of 197) -> Run 0
# Jobs:
# (* job:0 timeleft:1 tix:94 )  (  job:1 timeleft:6 tix:73 )  (  job:2 timeleft:3 tix:30 ) 
# --> JOB 0 DONE at time 14
# Random 464894 -> Winning ticket 55 (of 103) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:6 tix:73 )  (  job:2 timeleft:3 tix:30 )
# Random 318465 -> Winning ticket 92 (of 103) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:5 tix:73 )  (* job:2 timeleft:3 tix:30 )
# Random 380015 -> Winning ticket 48 (of 103) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:5 tix:73 )  (  job:2 timeleft:2 tix:30 )
# Random 891790 -> Winning ticket 16 (of 103) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:4 tix:73 )  (  job:2 timeleft:2 tix:30 )
# Random 525753 -> Winning ticket 41 (of 103) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:3 tix:73 )  (  job:2 timeleft:2 tix:30 )
# Random 560510 -> Winning ticket 87 (of 103) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:2 tix:73 )  (* job:2 timeleft:2 tix:30 )
# Random 236123 -> Winning ticket 47 (of 103) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:2 tix:73 )  (  job:2 timeleft:1 tix:30 )
# Random 23858 -> Winning ticket 65 (of 103) -> Run 1
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (* job:1 timeleft:1 tix:73 )  (  job:2 timeleft:1 tix:30 )
# --> JOB 1 DONE at time 22
# Random 325143 -> Winning ticket 3 (of 30) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:1 tix:30 )
# --> JOB 2 DONE at time 23



# ./W4/lottery.py -s 3 -j 3 -c

# ** Solutions **

# Random 13168 -> Winning ticket 88 (of 120) -> Run 1
# Jobs:
# (  job:0 timeleft:2 tix:54 )  (* job:1 timeleft:3 tix:60 )  (  job:2 timeleft:6 tix:6 )
# Random 837469 -> Winning ticket 109 (of 120) -> Run 1
# Jobs:
# (  job:0 timeleft:2 tix:54 )  (* job:1 timeleft:2 tix:60 )  (  job:2 timeleft:6 tix:6 )
# Random 259354 -> Winning ticket 34 (of 120) -> Run 0
# Jobs:
# (* job:0 timeleft:2 tix:54 )  (  job:1 timeleft:1 tix:60 )  (  job:2 timeleft:6 tix:6 )
# Random 234331 -> Winning ticket 91 (of 120) -> Run 1
# Jobs:
# (  job:0 timeleft:1 tix:54 )  (* job:1 timeleft:1 tix:60 )  (  job:2 timeleft:6 tix:6 )
# --> JOB 1 DONE at time 4
# Random 995645 -> Winning ticket 5 (of 60) -> Run 0
# Jobs:
# (* job:0 timeleft:1 tix:54 )  (  job:1 timeleft:0 tix:--- )  (  job:2 timeleft:6 tix:6 )
# --> JOB 0 DONE at time 5
# Random 470263 -> Winning ticket 1 (of 6) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:6 tix:6 )
# Random 836462 -> Winning ticket 2 (of 6) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:5 tix:6 )
# Random 476353 -> Winning ticket 1 (of 6) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:4 tix:6 )
# Random 639068 -> Winning ticket 2 (of 6) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:3 tix:6 ) 
# Random 150616 -> Winning ticket 4 (of 6) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:2 tix:6 )
# Random 634861 -> Winning ticket 1 (of 6) -> Run 2
# Jobs:
# (  job:0 timeleft:0 tix:--- )  (  job:1 timeleft:0 tix:--- )  (* job:2 timeleft:1 tix:6 )
# --> JOB 2 DONE at time 11



# T 1.2
# If the number of tickets is very imbalanced, then the job with the higher number of tickets will
# likely finish first before even touching the other job.
# In the case of -l 10:1,10:100, J0 is unlikely to get any run time before J1 is finished.
# J0 gets >= 1 second of run time - before J1 is finished - roughly 90% of time (99/100)^10.
# Such an imbalance in the number of tickets, leads to poor performance and large response times.


# T 1.3
# Roughly 90% fair, according to fig 9.2 from course book.
# With preliminary results from the lottery.py, the difference between finishing jobs is roughly 8 seconds.

# T 1.4
# When increasing -q (time slice), the scheduler becomes more unfair, due to smaller amount of switching. To combat this,
# the job length should be increased proportionally.



###################### TEHTÄVÄ 2 ###########################

def foo():
    print("Tasty banana!")
    
def kohta2():
    print(foo.__code__.co_code)
    print( [byte for byte in foo .__code__.co_code])
    # Teksti muoto tekisi koodista helpommin ymmärrettävää
    
def disas_foo():
    import dis
    dis.dis(foo)
    #>> ### Python loads the variables to the stack.
    #  3       0 LOAD_GLOBAL              0 (print)             ## Push 'print' to stacks
    #          2 LOAD_CONST               1 ('Tasty banana!')   ## Push string to stack
    #          4 CALL_FUNCTION            1                     ## Pops function and arg from stack and calls it, pushes return to stack           
    #          6 POP_TOP                                        ## Remove top of stack, to remove return value
    #          8 LOAD_CONST               0 (None)              ## Push to stack
    #         10 RETURN_VALUE                                   ## Return top of stack


def tehtava2():
    kohta2()
    disas_foo()



################## TEHTÄVÄ 3 ########################

def flat(num):

    if num % 3 == 0:

        print ("Fizz")

    elif num % 5 == 0:

        print ("Buzz")

    else:

        print (num)

 

def nested(num):

    if num % 3 == 0:

        print ("Fizz")

    else:

        if num % 5 == 0:

            print ("Buzz")

        else:

            print (num)

def tehtava3():
    ### Same as in Python, you can do the same thing in multiple ways.
    ### The bytecode might be different, but the end result could be the same.abs(x)
    
    import dis
    print("Disassembled 'flat'")
    """
    Disassembled 'flat'
  3           0 LOAD_FAST                0 (num)
              2 LOAD_CONST               1 (3)
              4 BINARY_MODULO
              6 LOAD_CONST               2 (0)
              8 COMPARE_OP               2 (==)
             10 POP_JUMP_IF_FALSE       12 (to 24)

  5          12 LOAD_GLOBAL              0 (print)
             14 LOAD_CONST               3 ('Fizz')
             16 CALL_FUNCTION            1
             18 POP_TOP
             20 LOAD_CONST               0 (None)
             22 RETURN_VALUE

  7     >>   24 LOAD_FAST                0 (num)
             26 LOAD_CONST               4 (5)
             28 BINARY_MODULO
             30 LOAD_CONST               2 (0)
             32 COMPARE_OP               2 (==)
             34 POP_JUMP_IF_FALSE       24 (to 48)

  9          36 LOAD_GLOBAL              0 (print)
             38 LOAD_CONST               5 ('Buzz')
             40 CALL_FUNCTION            1
             42 POP_TOP
             44 LOAD_CONST               0 (None)
             46 RETURN_VALUE

 13     >>   48 LOAD_GLOBAL              0 (print)
             50 LOAD_FAST                0 (num)
             52 CALL_FUNCTION            1
             54 POP_TOP
             56 LOAD_CONST               0 (None)
             58 RETURN_VALUE
    """
    
    dis.dis(flat)
    print("Disassembled 'nested'")
    """
    Disassembled 'nested'
 19           0 LOAD_FAST                0 (num)
              2 LOAD_CONST               1 (3)
              4 BINARY_MODULO
              6 LOAD_CONST               2 (0)
              8 COMPARE_OP               2 (==)
             10 POP_JUMP_IF_FALSE       12 (to 24)

 21          12 LOAD_GLOBAL              0 (print)
             30 LOAD_CONST               2 (0)
             32 COMPARE_OP               2 (==)
             34 POP_JUMP_IF_FALSE       24 (to 48)

 27          36 LOAD_GLOBAL              0 (print)
             38 LOAD_CONST               5 ('Buzz')
             40 CALL_FUNCTION            1
             42 POP_TOP
             44 LOAD_CONST               0 (None)
             46 RETURN_VALUE

 31     >>   48 LOAD_GLOBAL              0 (print)
             50 LOAD_FAST                0 (num)
             52 CALL_FUNCTION            1
             54 POP_TOP
             56 LOAD_CONST               0 (None)
             58 RETURN_VALUE 
    """
    dis.dis(nested)